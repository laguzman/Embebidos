#include <DHT.h>           // Librería para sensores DHT
#include <LiquidCrystal.h> // Librería para Pantalla LCD
// Se definen los pines en el Arduino correspondientes a cada componente
#define DHTPIN 8        // Pin del Sensor
#define DHTTYPE DHT11   // Tipo de DHT = DHT11
const int bulb_pin = 6; // Pin de relé de los focos
const int fan_pin = 7;  // Pin de relé de ventiladores
// Variables sensor y pantalla
DHT dht(DHTPIN, DHTTYPE);              // Sensor DHT11
LiquidCrystal lcd(12, 11, 5, 4, 3, 2); // Pantalla LCD
// Variables para Temperatura y Humedad Relativa
float temp = 0; // Temperatura
float rh = 0;   // Humedad Relativa (sin uso práctico)
// Función para convertir Celsius a Kelvin
float kelvin(float celsius) {
  float k;
  k = celsius + 273.15;
  return (k); }
// Configuración Inicial de Arduino
void setup() {
  Serial.begin(9600);       // Inicializa comunicación serial
  lcd.begin(16, 2);         // Inicializa pantalla LCD 16x2
  lcd.print("C:      K:");  // Imprime C: y K: para presentar datos
  lcd.setCursor(0, 1);      // Cursor de pantalla en columna=0, fila=1 (1er caracter de la 2da columna)
  lcd.print("Temperatura"); // Imprime "Temperatura" en la posición del cursor
  dht.begin();              // Inicializa sensor DHT11 }
// Lazo principal, arduino repite las siguientes instrucciones constantemente
// Similar a while
void loop() {
  // Lectura de Datos
  temp = dht.readTemperature() - 2; // Lee temperatura en Celsius
  // (-2 debido a desfase de lectura del sensor con la temperatura real)
  rh = dht.readHumidity(); // Lee humedad (sin uso práctico)
  // Verifica la correcta lectura de los datos
  if (isnan(rh) || isnan(temp)) {
    Serial.println("Error obteniendo los datos del sensor DHT11");
    return; }
  // Variable k guarda el valor de la temperatura en Kelvin
  float k = kelvin(temp);
  // Mueve el cursor de la pantalla a la 3era columna de la 1era fila
  lcd.setCursor(2, 0);
  lcd.print(temp); // Muestra el valor de la temperatura (Celsius)
  // Mueve el cursor de la pantalla a la 11va columna de la 1era fila
  lcd.setCursor(10, 0);
  lcd.print(k); // Muestra el valor de la temperatura (Kelvin)
  // Verifica temperatura
  if (temp > 37.5) {
    // Si la temperatura en celsius es mayor a 37.5:
    analogWrite(bulb_pin, 0);  // Apaga ambos focos
    analogWrite(fan_pin, 255); // Enciende ambos ventiladores
    delay(900); // Espera 900ms para poder apreciar lectura en pantalla LCD
    lcd.clear();                 // Limpia pantalla LCD
    lcd.begin(16, 2);            // Inicializa nuevamente pantalla LCD 16x2
    lcd.setCursor(0, 0);         // Mueve el cursor al inicio de la 1era fila
    lcd.print("ALERTA!");        // Imprime "ALERTA!" en la pantalla LCD
    lcd.setCursor(0, 1);         // Mueve el cursor al inicio de la 2da fila
    lcd.print("TEMP. MUY ALTA"); // Imprime "TEMP. MUY ALTA" en la pantalla LCD
    delay(900); // Espera 900ms para poder apreciar lectura en pantalla LCD
    lcd.clear();              // Limpia pantalla LCD
    lcd.begin(16, 2);         // Inicializa nuevamente pantall LCD 16x2
    lcd.print("C:      K:");  // Imprime C: y K: para presentar datos
    lcd.setCursor(0, 1);      // Cursor de pantalla en columna=0, fila=1 (1er
                              // caracter de la 2da columna)
    lcd.print("Temperatura"); // Imprime "Temperatura"
    lcd.setCursor(2, 0);  // Mueve el cursor a la 3era columna de la 1era fila
    lcd.print(temp);      // Imprime el valor de la temperatura en Celsius
    lcd.setCursor(10, 0); // Mueve el cursor a la 11va columna de 1era fila
    lcd.print(k);         // Imprime el valor de la temperatura en Kelvin
  } else {
    // Caso contrario (temperatura menor o igual a 37.5)
    analogWrite(bulb_pin, 255); // Enciende ambos focos
    analogWrite(fan_pin, 0);    // Apaga ambos ventiladores
    delay(900); // Espera 900ms para poder apreciar lectura en pantalla LCD
    lcd.clear();                 // Limpia pantalla LCD
    lcd.begin(16, 2);            // Inicializa nuevamente pantalla LCD 16x2
    lcd.setCursor(0, 0);         // Mueve el cursor al inicio de la 1era fila
    lcd.print("ALERTA!");        // Imprime "ALERTA!" en la pantalla LCD
    lcd.setCursor(0, 1);         // Mueve el cursor al inicio de la 2da fila
    lcd.print("TEMP. MUY BAJA"); // Imprime "TEMP. MUY BAJA" en la pantalla LCD
    delay(900); // Espera 900ms para poder apreciar lectura en pantalla LCD
    lcd.clear();              // Limpia pantalla LCD
    lcd.begin(16, 2);         // Inicializa nuevamente pantall LCD 16x2
    lcd.print("C:      K:");  // Imprime C: y K: para presentar datos
    lcd.setCursor(0, 1);      // Cursor de pantalla en columna=0, fila=1 (1er
                              // caracter de la 2da columna)
    lcd.print("Temperatura"); // Imprime "Temperatura"
    lcd.setCursor(2, 0);  // Mueve el cursor a la 3era columna de la 1era fila
    lcd.print(temp);      // Imprime el valor de la temperatura en Celsius
    lcd.setCursor(10, 0); // Mueve el cursor a la 11va columna de 1era fila
    lcd.print(k);         // Imprime el valor de la temperatura en Kelvin }
  delay(250); // Espera 250ms antes de realizar la siguiente lectura }
